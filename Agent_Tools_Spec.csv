模块/Agent,工具/函数名,核心功能（做什么）,主要输入字段,需要的数据窗口,调用方式（实时/预计算）,Redis缓存键命名/TTL建议,算法落地难度,备注/注意事项
数据治理,check_nan,扫描NaN/异常尖峰并生成报表,df:任意表; columns:列名列表/可空,同输入窗口,预计算（批处理/每日）,dq:{ticker}:{asof}:nan_report / TTL=1d,低,设定缺失率阈值；输出字段覆盖率与异常计数
数据治理,align_to_trading_calendar,按交易日历对齐时间序列并前/后填充,df:时间序列; calendar:交易所日历ID; method:规则,覆盖所需窗口,预计算（每日）,dq:{ticker}:{asof}:aligned / TTL=7d,低,使用官方日历；避免向未来条目泄露
数据治理,winsorize,按分位数裁剪极值（温莎化）,series; p_low=0.01; p_high=0.99,用该窗口计算分位数,预计算,dq:{field}:{asof}:win / TTL=7d,低,在审计日志中记录分位参数
数据治理,leakage_guard,按asof日期切分，阻断前视信息泄露,df; asof_date,N/A,预计算,dq:{asof}:leakage_guard / TTL=30d,低,训练/评估严格按时点切分
公司行为,apply_splits_dividends,根据分红/拆并生成前/后复权OHLCV,raw_ohlcv; corp_actions,建议≥1年,预计算（每日EOD）,adj:{ticker}:{asof}:ohlcv / TTL=7d,中,校验供应商因子；与股本变动一致
公司行为,event_window,围绕事件切片构造前后窗口特征,ts; event_date; pre:天数; post:天数,前后各30–60个bar,预计算,evt:{ticker}:{event}:{pre}:{post} / TTL=30d,低,多事件合并需去重
市场状态,trend_filter,用均线/突破判定市场多空趋势,"index_close; lookbacks=[20,60,120]",≥6个月,预计算（每日），实时只读,mrkt:trend:{index}:{asof} / TTL=1d,低,后续用于权重路由
市场状态,realized_vol,估计实现波动率（可用Parkinson替代）,index_returns; lb=20,≥3个月,预计算（每日）,mrkt:rv:{index}:{lb}:{asof} / TTL=1d,低,注意波动切 regime
市场状态,liquidity_proxy,基于换手/深度标注流动性状态,turnover; depth_proxy,≥3个月,预计算（每日）,mrkt:liq:{index}:{asof} / TTL=1d,低,若无盘口深度，用量能代理
基本面,calc_margins,计算毛利/营业/净利率及QoQ/YoY变化,quarterly_fin,≥12个季度,预计算（季度数据就绪后）,fin:{ticker}:margins:{qtr} / TTL=90d,中,注意财报重述
基本面,calc_leverage,杠杆与偿债：D/E、利息保障倍数,quarterly_fin,≥12个季度,预计算,fin:{ticker}:lev:{qtr} / TTL=90d,中,是否扣除租赁负债需一致
基本面,ocf_to_net_income,经营现金流/净利润比，盈利质量,cashflow; income,≥12个季度,预计算,fin:{ticker}:ocfni:{qtr} / TTL=90d,中,处理季节性与一次性项目
基本面,accruals_quality,应计质量（Sloan类）,balance; cashflow,≥12个季度,预计算,fin:{ticker}:accruals:{qtr} / TTL=90d,中,重述/口径变更风险
基本面,ttm_growth,TTM营收/利润增速,quarterly_fin,≥8个季度,预计算,fin:{ticker}:ttm_growth:{qtr} / TTL=90d,低,滚动TTM窗口
基本面,earnings_stability,TTM/3年EPS或营收稳定性（方差/波动）,quarterly_fin,≥12个季度,预计算,fin:{ticker}:earn_stab:{qtr} / TTL=90d,低,对异常值温莎化
基本面,valuation_percentiles,PE/PB/PS/EVEBITDA行业分位,prices; shares; fundamentals; industry,≥3年优先,预计算（每日）,fin:{ticker}:val_pct:{asof} / TTL=1d,中,行业映射需稳定
基本面,share_change_rate,识别股本摊薄/回购信号,share_history,≥12个季度,预计算,fin:{ticker}:shrchg:{qtr} / TTL=90d,低,与公司行为一致对齐
新闻,event_classifier,将新闻/公告分类为事件类型并打极性,news_text; metadata,近7–30天,预计算embedding+必要时实时分类,news:emb:{docid} / TTL=30d,高,可用微调或强零样本模型
新闻,impact_scoring,按新颖度/来源/时效衰减打事件影响分,event_type; timestamp; source,3–14天,实时（流式）,news:impact:{ticker}:{event}:{ts} / TTL=3d,中,指数型时间衰减λ可调
新闻,company_linker,实体链接：文本→股票代码,news_text; NER实体词典,N/A,预计算+实时回退,news:link:{docid} / TTL=30d,中,歧义需基于上下文消解
