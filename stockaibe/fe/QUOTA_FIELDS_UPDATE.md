# 配额字段更新说明

## 📋 更新内容

为配额管理功能添加了 `name` 和 `notes` 字段的前端支持。

## 🔧 修改的文件

### 1. `src/types/api.ts`
- ✅ 在 `Quota` 接口中添加 `name?: string` 字段
- ✅ 在 `QuotaCreate` 接口中添加 `name?: string` 字段
- ✅ 在 `QuotaUpdate` 接口中添加 `name?: string` 字段
- ✅ `notes` 字段已存在，无需修改

### 2. `src/pages/Quotas.tsx`
- ✅ 在表格中添加"名称"列（显示 `name` 字段）
- ✅ 在表格中添加"备注"列（显示 `notes` 字段）
- ✅ 在表单中添加"配额名称"输入框（必填）
- ✅ 添加 tooltip 说明：用于任务装饰器中的 quota_name 参数匹配
- ✅ 调整表格滚动宽度从 1400 到 1700
- ✅ 优化域名和端点字段的占位符文本

## 📊 表格列顺序

1. **ID** - 配额唯一标识（主键）
2. **名称** - 配额名称（用于任务匹配）⭐ 新增
3. **域名** - API 域名（可选）
4. **端点** - API 端点（可选）
5. **算法** - 限流算法（令牌桶/漏桶）
6. **容量** - 令牌桶容量
7. **补充速率** - 令牌补充速率
8. **状态** - 启用/禁用
9. **备注** - 配额说明 ⭐ 新增
10. **更新时间** - 最后更新时间
11. **操作** - 编辑/启用/禁用按钮

## 📝 表单字段

### 必填字段
- **配额 ID** - 唯一标识符（创建后不可修改）
- **配额名称** - 用于任务装饰器匹配 ⭐ 新增

### 可选字段
- 域名
- 端点
- 算法（默认：令牌桶）
- 容量（默认：60）
- 补充速率（默认：1.0）
- 泄漏速率
- 突发容量
- 启用状态（默认：启用）
- 备注

## 🎯 字段说明

### name 字段
- **用途**：用于任务装饰器中的 `quota_name` 参数匹配
- **示例**：
  ```python
  @LimitTask(
      id="api_call_001",
      name="调用外部API",
      quota_name="external_api"  # ← 这里匹配 Quota.name
  )
  ```
- **前端显示**：表格"名称"列
- **表单位置**：配额 ID 之后，第二个字段
- **验证规则**：必填

### notes 字段
- **用途**：配额的详细说明和备注
- **示例**：
  - "限制外部 API 调用频率，每秒最多 1 次调用"
  - "防止邮件服务过载，每 10 秒补充 1 个令牌"
- **前端显示**：表格"备注"列（支持文本省略）
- **表单位置**：表单最后一个字段
- **输入类型**：多行文本框（3 行）

## 🔗 与后端的对应关系

### 后端模型（models.py）
```python
class Quota(SQLModel, table=True):
    id: str = Field(primary_key=True)
    name: Optional[str] = Field(default=None)  # ← 新增
    domain: Optional[str] = Field(default=None)
    # ... 其他字段
    notes: Optional[str] = Field(default=None)
```

### 前端类型（api.ts）
```typescript
export interface Quota {
  id: string;
  name?: string;  // ← 新增
  domain?: string;
  // ... 其他字段
  notes?: string;
}
```

## ✅ 测试建议

1. **创建配额**
   - 填写 ID 和 name（必填）
   - 添加备注说明
   - 验证保存成功

2. **编辑配额**
   - 修改 name 字段
   - 更新 notes 内容
   - 验证更新成功

3. **查看列表**
   - 确认"名称"列正确显示
   - 确认"备注"列正确显示
   - 测试文本省略功能

4. **与任务系统集成**
   - 创建配额时 name 设置为 "external_api"
   - 在任务装饰器中使用 `quota_name="external_api"`
   - 验证任务能正确关联配额

## 🚀 部署说明

前端修改完成后：
1. 重新编译前端代码
2. 刷新浏览器页面
3. 验证新字段显示正常
4. 测试创建和编辑功能

后端已完成相关修改，无需额外操作。
